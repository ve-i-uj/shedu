input{
    file{
        path => "/opt/kbengine/assets/logs/*.log"
        start_position => beginning
    }
}

filter {
  mutate {
    strip => "message"
  }
  if [log][file][path] == "/opt/kbengine/assets/logs/machine.log" {
    grok {
      patterns_dir => "/usr/share/logstash/config/patterns/"
      match => {
        "message" => "%{KBE_LOG_LEVEL:kbe_log_level}%{SPACE}%{COMPONENT_NAME:component_name} \[%{KBE_TIMESTAMP_MACHINE:kbe_timestamp_machine}\] - %{GREEDYDATA:logmessage}"
      }
    }
  } else {
    grok {
      patterns_dir => "/usr/share/logstash/config/patterns/"
      match => {
        "message" => "%{KBE_LOG_LEVEL:kbe_log_level}%{SPACE}%{COMPONENT_NAME:component_name} %{NUMBER:uid} %{NUMBER:cid}%{SPACE}\[%{KBE_TIMESTAMP:kbe_timestamp}] - %{GREEDYDATA:logmessage}"
      }
    }
  }
  if [message] == "" {
    drop { }
  }
}

output {
    elasticsearch {
      hosts => ["http://kbe-log-elk-elastic:9200"]
      index => "kbe-logs-%{+YYYY.MM.dd}"
  }
}
